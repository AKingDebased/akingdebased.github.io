<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>spotify api and marionette</title>
  <meta name="description" content="you can find the final application here">

  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/backbone,/marionette,/2016/06/13/spotify-api-and-marionette.html">
  <link rel="alternate" type="application/rss+xml" title="gabriel gonzalvez" href="/feed.xml">
  
  
</head>


  <body>

    <header class="header-container" role="banner">



  <h1 class="header-container__main-title">GABRIEL GONZALVEZ</h1>
    <div class="header-container__subtitle">Front End Web Developer, Rogue, and Peasant Slave</div>
      <div class="header-container__links">
        <span class="header-container__link">github</span>
        <span class="header-container__link">linkedin</span>
        <span class="header-container__link">who?</span>
        <span class="header-container__link">r&Eacute;sum&Eacute;</span>
        <span class="header-container__link">contact</span>
      </div>
    </div>
  <hr>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">spotify api and marionette</h1>
    <p class="post-meta">
      <time datetime="2016-06-13T00:00:00-07:00" itemprop="datePublished">
        
        Jun 13, 2016
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>you can find the final application <a href="https://project-2181696919058931612.firebaseapp.com/">here</a></p>

<p>spotify has a great <a href="https://developer.spotify.com/web-api/">api</a> that allows you to, among other things, search song, artist, and album information. one of the end points they supply gives a listing of a given artist’s top 10 tracks by country (according to spotify). with that in mind, let me take you back to the frontier days of 2006. back then, there was this great little website called “i just want to listen to the best of…” that allowed you to search up an artist and listen to their most popular tracks (according to grooveshark). turns out that site no longer exists. so, i’m here to fill the void.</p>

<h2 id="querying-the-server">querying the server</h2>

<p>searching a given artist is a two step promise. first, an artist’s unique ID number must be acquired. this can be found at the <code class="highlighter-rouge">/search</code> endpoint. for example, a request to  <code class="highlighter-rouge">https://api.spotify.com/v1/search?q=mountain%20goats&amp;type=artist</code> will return an object containing all information for artists matching “Mountain Goats”. from there, the <code class="highlighter-rouge">items</code> array can be iterated over, and the correct <code class="highlighter-rouge">id</code> property extracted.</p>

<p>here’s a code sample using jQuery’s ajax method and the returned <a href="https://api.jquery.com/category/deferred-object/">deferred object</a></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">method</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span><span class="s2">"https://api.spotify.com/v1/search"</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:{</span>
    <span class="na">q</span><span class="p">:</span><span class="s2">"mountain goats"</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span><span class="s2">"artist"</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">artistData</span><span class="p">){</span>
  <span class="cm">/* for simplicity's sake, we'll assume the first element of
  the items array is the closest artist match */</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"artist's id is"</span><span class="p">,</span><span class="nx">artistData</span><span class="p">.</span><span class="nx">artists</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">)</span>
<span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">})</span>
</code></pre>
</div>

<p>from there, we can use the artist id to make another query to the <code class="highlighter-rouge">/artists</code> end point.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">method</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span><span class="s2">"https://api.spotify.com/v1/search"</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:{</span>
    <span class="na">q</span><span class="p">:</span><span class="s2">"mountain goats"</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span><span class="s2">"artist"</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">artistData</span><span class="p">){</span>
  <span class="c1">//assuming first result is the searched artist</span>
  <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">method</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span><span class="s2">"https://api.spotify.com/v1/artists/"</span> <span class="o">+</span> <span class="nx">artistData</span><span class="p">.</span><span class="nx">artists</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">"/top-tracks"</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:{</span>
      <span class="c1">//defaults to top US tracks</span>
      <span class="na">country</span><span class="p">:</span><span class="s2">"US"</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">topTracks</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"the mountain goats' top tracks"</span><span class="p">,</span><span class="nx">topTracks</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<h2 id="displaying-the-data">displaying the data</h2>

<p>truth be told, an application this simple could be easily done with raw javascript and plain html &amp; css. that said, i wanted to get some practice with <a href="http://marionettejs.com/">marionette</a>. to keep things simple, i organized the entire design within one <code class="highlighter-rouge">LayoutView</code>, split into two regions: <code class="highlighter-rouge">Search</code> and <code class="highlighter-rouge">Results</code>. each new search triggers a rerender of the <code class="highlighter-rouge">Results</code> region, which then uses underscore’s <code class="highlighter-rouge">_.template()</code> function to create a <code class="highlighter-rouge">Track</code> view for each of the artist’s top tracks.</p>

<h2 id="the-final-product">the final product</h2>

<p>you can check out the finished app <a href="https://project-2181696919058931612.firebaseapp.com/">here</a></p>

  </div>

  
</article>

      </div>
    </main>

  </body>

</html>
