<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title></title>
    <link>http://localhost:4000</link>
    <description>
      web dev, maker, and cosplayer.
    </description>
    
        
            <item>
                <title>aws alerts &amp; slack integration</title>
                <link>http://localhost:4000/aws/elasticache/slack/lambda/2019/01/05/aws-alerts-&-slack-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <p>i used to work on the <a href="https://www.glo.com/">glo</a> team, and while there, we used <a href="https://aws.amazon.com/elasticache/">amazon elasticache</a> for all of our caching needs. the decision to move to elasticache happened during my tenure, shortly after we had issues with our locally hosted <a href="https://redis.io/">redis</a> service crashing. we decided to delegate responsibility for cache hosting onto amazon.  as a member of the web team, i took it upon myself to a) set up our elasticache settings and b) implement a slack integration that would chirp out helpful status alerts based on certain metrics.</p>

<h2 id="setting-up-elasticache">setting up elasticache</h2>

<p>our elasticache needs were not extensive. we wanted two redis clusters, one for our web team and the other for our services team. behind the scenes, this required minor reconfiguration of our <code class="highlighter-rouge">env</code> files on both the web and services end, such that the apps now pointed to amazon. in the interest of making our app’s bootstrapping as easily reproducible as possible, i set up a <a href="https://aws.amazon.com/cloudformation/">cloudformation</a> template that included the following lines:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">EnableClusterA</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">String</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Enable</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">Cluster</span><span class="nv"> </span><span class="s">A.</span><span class="nv"> </span><span class="s">Disabling</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">cluster</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">remove</span><span class="nv"> </span><span class="s">both</span><span class="nv"> </span><span class="s">replicated</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">non-replicated</span><span class="nv"> </span><span class="s">versions</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">cluster.'</span>
    <span class="na">AllowedValues</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">true</span><span class="pi">,</span> <span class="nv">false</span><span class="pi">]</span>
    <span class="na">Default</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">EnableClusterB</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">String</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Enable</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">Cluster</span><span class="nv"> </span><span class="s">B.</span><span class="nv"> </span><span class="s">Disabling</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">cluster</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">remove</span><span class="nv"> </span><span class="s">both</span><span class="nv"> </span><span class="s">replicated</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">non-replicated</span><span class="nv"> </span><span class="s">versions</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">cluster.'</span>
    <span class="na">AllowedValues</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">true</span><span class="pi">,</span> <span class="nv">false</span><span class="pi">]</span>
    <span class="na">Default</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>in other words, instead of manually spinning up our elasticache clusters through the elasticache dashboard, we relied on cloudformation to generate clusters per my template.</p>

<h2 id="slack-integration-with-amazon-lambda">slack integration with amazon lambda</h2>

<p>i set up <a href="https://aws.amazon.com/cloudwatch/">cloudwatch</a> to watch our elasticache clusters for the health of metrics including cpu utilization and cache evictions. with input from the team, i determined healthy, unhealthy, and dangerous levels for these metrics, and then set up cloudwatch alerts to watch for these numbers. when any of these thresholds were crossed, <a href="https://aws.amazon.com/sns/">sns</a> would fire off a message to <a href="https://aws.amazon.com/lambda/">lambda</a>, where it would be received by a node script i wrote.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'https'</span><span class="p">),</span>
	<span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">),</span>
	<span class="nx">slackUrl</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">slackUrl</span><span class="p">,</span>
	<span class="nx">slackChannel</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">slackChannel</span><span class="p">,</span>
	<span class="nx">slackReqOpts</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">slackUrl</span><span class="p">);</span>

<span class="nx">slackReqOpts</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="s1">'POST'</span><span class="p">;</span>
<span class="nx">slackReqOpts</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">};</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">Records</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Sns</span><span class="p">.</span><span class="nx">Message</span><span class="p">),</span>
		<span class="nx">slackTitle</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">Trigger</span><span class="p">.</span><span class="nx">Namespace</span>  <span class="o">+</span> <span class="s1">' - '</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">Trigger</span><span class="p">.</span><span class="nx">MetricName</span><span class="p">,</span>
		<span class="nx">status</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">AlarmDescription</span> <span class="o">||</span> <span class="s1">'Warning'</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">NewStateValue</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="s1">'OK'</span><span class="p">:</span>
			<span class="nx">status</span> <span class="o">=</span> <span class="s1">'Good'</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="s1">'ALARM'</span><span class="p">:</span>
			<span class="nx">status</span> <span class="o">=</span> <span class="s1">'Warning'</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">let</span>	<span class="nx">slackMessage</span> <span class="o">=</span> <span class="p">{</span>
			<span class="na">text</span><span class="p">:</span> <span class="nx">status</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">'danger'</span> <span class="p">?</span> <span class="s1">'&lt;!channel&gt;'</span> <span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
			<span class="na">channel</span><span class="p">:</span> <span class="nx">slackChannel</span><span class="p">,</span>
		    <span class="na">attachments</span><span class="p">:</span> <span class="p">[{</span>
	            <span class="na">fallback</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">NewStateReason</span><span class="p">,</span>
	            <span class="na">color</span><span class="p">:</span> <span class="nx">status</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
	            <span class="na">title</span><span class="p">:</span> <span class="nx">slackTitle</span><span class="p">,</span>
				<span class="na">text</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">NewStateReason</span><span class="p">,</span>
	            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
	                <span class="p">{</span>
	                    <span class="na">title</span><span class="p">:</span> <span class="s2">"Node"</span><span class="p">,</span>
	                    <span class="na">value</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">Trigger</span><span class="p">.</span><span class="nx">Dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
						<span class="na">short</span><span class="p">:</span> <span class="kc">true</span>
	                <span class="p">},</span> <span class="p">{</span>
						<span class="na">title</span><span class="p">:</span> <span class="s2">"Status"</span><span class="p">,</span>
						<span class="na">value</span><span class="p">:</span> <span class="nx">status</span><span class="p">,</span>
						<span class="na">short</span><span class="p">:</span> <span class="kc">true</span>
					<span class="p">},</span>
					<span class="p">{</span>
						<span class="na">title</span><span class="p">:</span> <span class="s2">"Region"</span><span class="p">,</span>
						<span class="na">value</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">Region</span><span class="p">,</span>
						<span class="na">short</span><span class="p">:</span> <span class="kc">true</span>
					<span class="p">}</span>
	            <span class="p">]</span>
	        <span class="p">}]</span>
		<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">slackReqOpts</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">context</span><span class="p">.</span><span class="nx">succeed</span><span class="p">(</span><span class="s1">'posted to slack'</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">context</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="s1">'status code: '</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">});</span>

		<span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="nx">context</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
		<span class="p">});</span>

		<span class="nx">req</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">slackMessage</span><span class="p">));</span>
		<span class="nx">req</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="the-final-product">the final product</h2>

<p><img src="https://i.imgur.com/y7Xu9dw.png" alt="'good' status" />
<img src="https://i.imgur.com/Y918qdj.png" alt="'warning' status" /></p>

<p>after all the above leg work, these messages get piped into a special <code class="highlighter-rouge">ops-alerts</code> slack channel. the net result of all this is that those on pager duty (including myself) are able to immediately see if anything’s gone awry with our elasticache service. the above pattern has also been used for similar alerts with our other amazon web services, and has generally helped the sanity of anyone trying to stay ahead of potential issues within our app.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/aws/elasticache/slack/lambda/2019/01/05/aws-alerts-&-slack-integration/</guid>
                <description>
                    
                </description>
                <pubDate>Sat, 05 Jan 2019 00:00:00 -0800</pubDate>
                <author>gabriel gonzalvez</author>
            </item>
        
    
        
            <item>
                <title>webhook microservice with express, contentful, and objection</title>
                <link>http://localhost:4000/contentful/orm/webhook/node/express/glo/2018/08/13/contentful-cms-webhook-service/</link>
                <content:encoded>
                    <![CDATA[
                    <p>there’s few things i love more than automating processes. i used to work on the <a href="https://www.glo.com/">glo</a> team as a web developer, and amongst many other features, glo offers programs, which allow users to take thematically linked classes of a certain difficulty in a progressive order. for a long time, program classes had to be manually inputted into our database by an engineer. programs could have anywhere between 3 and 54 classes, so this got tedious fast. we wanted to shift this responsibility from our devs to our content team, such that there would be no need for a dev to upload new programs. i saw this as a great opportunity to automate a tedious process. the services team and i decided a <a href="https://en.wikipedia.org/wiki/Content_management_system">cms</a> was our best option. i spearheaded this project and, after a bit of research, i encouraged us to use <a href="https://www.contentful.com/">contentful</a>.</p>

<h2 id="implementing-contentful">implementing contentful</h2>

<p>contentful has a concept of <a href="https://www.contentful.com/r/knowledgebase/content-modelling-basics/">content models</a>, which act as a blueprint for a type of content (go figure). i started with a <code class="highlighter-rouge">program</code> content model that would allow our content team to input all the specifics of a program with a user-friendly interface; no CLI tools here. contentful would eventually be talking to our database by way of a node based service combined with express.js, so there were data models from our postgres database that i had to translate into contentful content models. within our database, the <code class="highlighter-rouge">program</code> model came with title, teachers, duration, difficulty, etc, relationships to props (fit blocks, chairs, yoga mats, etc) and tags (used for filtering on all programs), and all of this needed to be reflected in contentful.</p>

<h2 id="listening-to-webhooks">listening to webhooks</h2>

<p>contentful comes with the ability to set up webhooks that can <code class="highlighter-rouge">POST</code> to provided endpoints. to that effect, i created a <a href="https://www.docker.com/">dockerized</a>, node based, microservice that i maintained through the <a href="https://rancher.com/">rancher GUI</a>. using express.js, i set up a <code class="highlighter-rouge">POST /cms-listener</code> end point, and fed that to contentful through its webhook gui. anytime a change to a contentful model is detected, contentful fires off a <code class="highlighter-rouge">POST</code> to my <code class="highlighter-rouge">/cms-listener</code> endpoint, providing a JSON snapshot of the model at the time of publication. from there, the flow is as follows:</p>

<ul>
  <li>verify that the fired event is of type <code class="highlighter-rouge">publish</code> and the received content of type <code class="highlighter-rouge">program</code> (for all its features, contentful does not provide a way to limit the types of events it fires off)</li>
  <li>serialize the program data into a format the <code class="highlighter-rouge">objection.js</code> orm library understands. this data would eventually be <a href="https://wiki.postgresql.org/wiki/UPSERT">upserted</a> into our database. roughly speaking, that logic looks as follows:</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// the fields in the contentful json are all camelCased, and need to be snake cased in order to upsert properly into our database.</span>
<span class="c1">// here, i used lodash's 'reduce' method to perform these string conversions.</span>
<span class="kd">let</span> <span class="nx">programClassIds</span><span class="p">,</span>
    <span class="nx">props</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">dataToUpsert</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">contentfulPayload</span><span class="p">.</span><span class="nx">programFields</span><span class="p">,</span> <span class="p">(</span><span class="nx">upsertionObj</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">fieldName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">fieldName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">'programLevel'</span><span class="p">:</span>
            <span class="nx">fieldName</span> <span class="o">=</span> <span class="s1">'program_level_id'</span><span class="p">;</span>
            <span class="c1">// elsewhere in the file is a 'helpers' namespace that contains, funnily enough, helper methods that assist in serialization</span>
            <span class="nx">data</span><span class="p">[</span><span class="s1">'en-US'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">helpers</span><span class="p">.</span><span class="nx">convertLevel</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="s1">'en-US'</span><span class="p">]);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">'classIds'</span><span class="p">:</span>
            <span class="nx">programClassIds</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="s1">'en-US'</span><span class="p">];</span>
            <span class="k">return</span> <span class="nx">upsertionObj</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">'props'</span><span class="p">:</span>
            <span class="nx">props</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="s1">'en-US'</span><span class="p">];</span>
            <span class="k">return</span> <span class="nx">upsertionObj</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">upsertionObj</span><span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">snakeCase</span><span class="p">(</span><span class="nx">fieldName</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="s1">'en-US'</span><span class="p">];</span>

    <span class="k">return</span> <span class="nx">upsertionObj</span><span class="p">;</span>
<span class="p">},</span> <span class="p">{});</span>
</code></pre></div></div>

<ul>
  <li>upsert the serialized program into our database.</li>
  <li>get all program classes associated with this program by their unique IDs, then serialize and upsert these program classes into the already upserted program’s <code class="highlighter-rouge">programClasses</code> row. serializiation for program classe looks similar to the following:</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// all i needed to do here was convert a string to an int, and also bump the index of the 'sort_order`, since our database is 1-indexed</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">classIds</span><span class="p">,</span> <span class="p">(</span><span class="nx">classId</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="na">program_id</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">programId</span><span class="p">),</span>
    <span class="na">class_id</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">classId</span><span class="p">),</span>
    <span class="na">sort_order</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}));</span>
</code></pre></div></div>
<p><strong>note:</strong> i intentionally upserted the program before serializing program classes. for this iteration of the webhook, we, as a team, decided that it was fine if, say a <code class="highlighter-rouge">program</code> was successfully serialized and upserted, but its <code class="highlighter-rouge">programClasses</code> failed upsertion.</p>

<p>and that’s it! well, generally speaking. once the above steps are finished, an instance of a <code class="highlighter-rouge">program</code> contentful model is successfully serialized &amp; upserted into our own database, and ready for production deployment.</p>

<h2 id="final-thoughts">final thoughts</h2>

<p>this was one of my favorite projects at glo. i find it very satisfying creating services that will benefit other members of my team. also, i was the creater and admin of the github repo for this project, as well as the maintainer of the docker service. though other people ended up working on this project, i was the very first commit in the repo, and i laid the groundwork for further iterations. everything about the service, from the usage of contentful, to the reliance on <code class="highlighter-rouge">objection.js</code>, to the architecture of the express app, was all by my design. this project was my baby, and is a proud memory from my days at glo.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/contentful/orm/webhook/node/express/glo/2018/08/13/contentful-cms-webhook-service/</guid>
                <description>
                    
                </description>
                <pubDate>Mon, 13 Aug 2018 00:00:00 -0700</pubDate>
                <author>gabriel gonzalvez</author>
            </item>
        
    
        
            <item>
                <title>spotify api and marionette</title>
                <link>http://localhost:4000/backbone,/marionette,/2016/06/13/spotify-api-and-marionette/</link>
                <content:encoded>
                    <![CDATA[
                    <p><del>you can find the final application <a href="https://project-2181696919058931612.firebaseapp.com/">here</a></del> <strong>author’s note:</strong> though this link still works, spotify has long since changed its api such that this app no longer works as originally designed. you can still look at it, though!</p>

<p>spotify has a great <a href="https://developer.spotify.com/web-api/">api</a> that allows you to, among other things, search song, artist, and album information. one of the end points they supply gives a listing of a given artist’s top 10 tracks by country (according to spotify). with that in mind, let me take you back to the frontier days of 2006. back then, there was this great little website called “i just want to listen to the best of…” that allowed you to search up an artist and listen to their most popular tracks (according to grooveshark). turns out that site no longer exists. so, i’m here to fill the void.</p>

<h2 id="querying-the-server">querying the server</h2>

<p>searching a given artist is a two step promise. first, an artist’s unique ID number must be acquired. this can be found at the <code class="highlighter-rouge">/search</code> endpoint. for example, a request to  <code class="highlighter-rouge">https://api.spotify.com/v1/search?q=mountain%20goats&amp;type=artist</code> will return an object containing all information for artists matching “Mountain Goats”. from there, the <code class="highlighter-rouge">items</code> array can be iterated over, and the correct <code class="highlighter-rouge">id</code> property extracted.</p>

<p>here’s a code sample using jQuery’s ajax method and the returned <a href="https://api.jquery.com/category/deferred-object/">deferred object</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">method</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span><span class="s2">"https://api.spotify.com/v1/search"</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:{</span>
    <span class="na">q</span><span class="p">:</span><span class="s2">"mountain goats"</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span><span class="s2">"artist"</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">artistData</span><span class="p">){</span>
  <span class="cm">/* for simplicity's sake, we'll assume the first element of
  the items array is the closest artist match */</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"artist's id is"</span><span class="p">,</span><span class="nx">artistData</span><span class="p">.</span><span class="nx">artists</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">)</span>
<span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div></div>

<p>from there, we can use the artist id to make another query to the <code class="highlighter-rouge">/artists</code> end point.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">method</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span><span class="s2">"https://api.spotify.com/v1/search"</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:{</span>
    <span class="na">q</span><span class="p">:</span><span class="s2">"mountain goats"</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span><span class="s2">"artist"</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">artistData</span><span class="p">){</span>
  <span class="c1">//assuming first result is the searched artist</span>
  <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">method</span><span class="p">:</span><span class="s2">"GET"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span><span class="s2">"https://api.spotify.com/v1/artists/"</span> <span class="o">+</span> <span class="nx">artistData</span><span class="p">.</span><span class="nx">artists</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">"/top-tracks"</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:{</span>
      <span class="c1">//defaults to top US tracks</span>
      <span class="na">country</span><span class="p">:</span><span class="s2">"US"</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">topTracks</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"the mountain goats' top tracks"</span><span class="p">,</span><span class="nx">topTracks</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="displaying-the-data">displaying the data</h2>

<p>truth be told, an application this simple could be easily done with raw javascript and plain html &amp; css. that said, i wanted to get some practice with <a href="http://marionettejs.com/">marionette</a>. to keep things simple, i organized the entire design within one <code class="highlighter-rouge">LayoutView</code>, split into two regions: <code class="highlighter-rouge">Search</code> and <code class="highlighter-rouge">Results</code>. each new search triggers a rerender of the <code class="highlighter-rouge">Results</code> region, which then uses underscore’s <code class="highlighter-rouge">_.template()</code> function to create a <code class="highlighter-rouge">Track</code> view for each of the artist’s top tracks.</p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/backbone,/marionette,/2016/06/13/spotify-api-and-marionette/</guid>
                <description>
                    
                </description>
                <pubDate>Mon, 13 Jun 2016 00:00:00 -0700</pubDate>
                <author>gabriel gonzalvez</author>
            </item>
        
    
        
            <item>
                <title>backing up minecraft servers</title>
                <link>http://localhost:4000/minecraft,/snippets/2016/05/31/backing-up-minecraft-servers/</link>
                <content:encoded>
                    <![CDATA[
                    <p>recently, my roommate and i have been playing a lot of minecraft. i’ve been hosting a local server for us, and keeping all the files stored on my main computer. however, idiots that we are, there’s more than a few times that we need to roll back to previous versions.  luckily, server back ups are as simple as copying the <code class="highlighter-rouge">world</code> folder. so, i wrote this tiny bash script to do just that:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">today</span><span class="o">=</span><span class="k">$(</span>date +%Y-%m-%d<span class="k">)</span><span class="p">;</span>
<span class="nv">currentTime</span><span class="o">=</span><span class="k">$(</span>date +%T<span class="k">)</span><span class="p">;</span>

mkdir <span class="nt">-p</span> ./backups/<span class="nv">$today</span>/<span class="nv">$currentTime</span><span class="p">;</span>
cp <span class="nt">-r</span> ./world/<span class="k">*</span> ./backups/<span class="nv">$today</span>/<span class="nv">$currentTime</span><span class="p">;</span>
</code></pre></div></div>

<p>this little snippet is run in the command line using <code class="highlighter-rouge">backup-world.sh</code>. it looks in the current directoy (i.e., the server folder) for a folder called <code class="highlighter-rouge">backups</code> and creates inside of it a folder with today’s date, and inside that a folder with a timestamp. multiple back ups on the same day create new folders in the same date folder with different timestamps.</p>

<p>the script then copies all the files in the <code class="highlighter-rouge">world</code> folder to the <code class="highlighter-rouge">currentTime</code> folder. and that, as they say, is that. quick, dirty, functional - just the way i like it.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/minecraft,/snippets/2016/05/31/backing-up-minecraft-servers/</guid>
                <description>
                    
                </description>
                <pubDate>Tue, 31 May 2016 00:00:00 -0700</pubDate>
                <author>gabriel gonzalvez</author>
            </item>
        
    
        
            <item>
                <title>playing with react</title>
                <link>http://localhost:4000/react/2016/05/18/playing-with-react/</link>
                <content:encoded>
                    <![CDATA[
                    <p>so, after a short stint with backbone and marionette, i’ve <strike>hopped on the bandwagon</strike> tried out the latest hotness on the scene, react.js.</p>

<h2 id="react">react</h2>
<p>react offers up just the V part of the MVC. in other words, react has no opinion on how you should structure your raw data, nor does it offer any solutions for coordinating events between model or view. while this may sound sparse (who doesn’t appreciate some structure?), i actually find the flexibility this offers quite refreshing. <a href="http://backbonejs.org/">backbone.js</a> is my current favorite MV* framework, and it plays very nicely with react’s unopinionated stance on models and controllers.</p>

<p>one of the really cool things about react is that it comes with a <a href="https://facebook.github.io/react/docs/glossary.html">virtual dom</a>. the virtual dom is, as the name suggests, a copy of the DOM that react maintains at all times. whenever you change a <code class="highlighter-rouge">reactElement</code> (most commonly done through <code class="highlighter-rouge">reactComponents</code>), react checks the changes between the “real” DOM and its virtual DOM, and only updates the delta. calls to <code class="highlighter-rouge">ReactDOM.render()</code> allow react to use its virtual DOM to rapidly update your view, especially in contrast to most varieties of query selection.</p>

<h2 id="code-sample">code sample</h2>
<p>react is cool, but it’s even cooler seeing it in action. check out <a href="http://codepen.io/AKingDebased/pen/XdLbrw?editors=0010">this codepen</a> that renders a simple user and friends list, and allows you to add or remove friends. there’s also some other bells and whistles, like semi-persistent data through the <code class="highlighter-rouge">localStorage</code> object.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/react/2016/05/18/playing-with-react/</guid>
                <description>
                    
                </description>
                <pubDate>Wed, 18 May 2016 00:00:00 -0700</pubDate>
                <author>gabriel gonzalvez</author>
            </item>
        
    
  </channel>
</rss>
